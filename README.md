# Secure API

## Назначение:
Получить практический опыт разработки безопасного backend-приложения с
автоматизированной проверкой кода на уязвимости. Освоить принципы защиты от OWASP Top 10 и
интеграцию инструментов безопасности в процесс разработки.
## Эндпоинты

### 1. Регистрация пользователя
**POST /auth/register**
- **Описание**: Регистрирует нового пользователя.
- **Параметры запроса**:
    ```json
    {
        "login": "alice",
        "password": "Str0ng_P@ss"
    }
    ```
- **Ответ**:
    ```json
    {
        "message": "registered"
    }
    ```

### 2. Логин
**POST /auth/login**
- **Описание**: Логин пользователя и получение JWT-токена.
- **Параметры запроса**:
    ```json
    {
        "login": "alice",
        "password": "Str0ng_P@ss"
    }
    ```
- **Ответ**:
    ```json
    {
        "access_token": "JWT_TOKEN"
    }
    ```

### 3. Получение данных
**GET /api/data**
- **Описание**: Получение списка постов (данных).
- **Требует авторизации**: да (токен передаётся в заголовке `Authorization`).
- **Ответ**:
    ```json
    {
        "items": [
            {
                "id": 1,
                "title": "Post 1",
                "body": "This is the body of post 1"
            }
        ]
    }
    ```

### 4. Создание поста
**POST /api/posts**
- **Описание**: Создание нового поста.
- **Требует авторизации**: да (токен передаётся в заголовке `Authorization`).
- **Параметры запроса**:
    ```json
    {
        "title": "New Post",
        "body": "This is the body of the new post"
    }
    ```
- **Ответ**:
    ```json
    {
        "message": "created",
        "id": 1
    }
    ```

## Реализованные меры защиты

### 1. Защита от SQLi
- Для работы с базой данных используется **SQLAlchemy ORM**, что исключает возможность SQL-инъекций. Все запросы выполняются с использованием параметризированных запросов, что гарантирует безопасное выполнение запросов.

### 2. Защита от XSS
- Все данные, возвращаемые в ответах API, экранируются с помощью функции `escape()` из библиотеки **markupsafe**. Это предотвращает выполнение вредоносного кода, внедрённого через пользовательский ввод.

### 3. Аутентификация и авторизация
- Для аутентификации используется **JWT** (JSON Web Tokens). После успешного логина пользователь получает токен, который должен быть передан в заголовке `Authorization` для доступа к защищённым эндпоинтам.
- Пароли пользователей хэшируются с помощью **bcrypt**, что исключает хранение паролей в открытом виде.

## Интеграция с CI/CD

Проект интегрирован с **GitHub Actions** для автоматического выполнения проверок безопасности кода и зависимостей.

### 1. **SAST (Static Application Security Testing)**:
- Используется **Bandit** для проверки кода на уязвимости (например, SQLi, XSS).
- Команда:
    ```bash
    bandit -r app/
    ```

### 2. **SCA (Software Composition Analysis)**:
- Используется **Safety** для проверки зависимостей на уязвимости.
- Команда:
    ```bash
    safety check --full-report
    ```

### 3. **Pip-Audit**:
- Проводится аудит зависимостей на известные уязвимости.
- Команда:
    ```bash
    pip-audit --exit-code 1
    ```

## Скриншоты отчетов из CI/CD

Ниже приведены скриншоты с отчётами по безопасности из раздела "Actions" на GitHub:


---

